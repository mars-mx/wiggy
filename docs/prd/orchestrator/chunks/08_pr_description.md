# Chunk 08: PR Description Generation — Artifact Template & Wiring

## Objective

Create the `pr_description` artifact template, wire the finalization artifact into the PR creation flow, and add a fallback for when the orchestrator is disabled.

## Scope

**Files to create:**

- `src/wiggy/templates/default/pr_description/template.yaml`
- `src/wiggy/templates/default/pr_description/content.md`

**Files to modify:**

- `src/wiggy/git/operations.py` — Modify `create_pull_request()` to accept and use an orchestrator-generated PR body.
- `src/wiggy/processes/orchestrator.py` — After finalization, read the `pr_description` artifact and pass it to the PR creation flow.

**Dependencies from previous chunks:**

- Chunk 05: `orchestrator-finalize` prompt instructs the agent to write a `pr_description` artifact.
- Chunk 06: Finalization phase runs after all steps.

## Detailed Requirements

### 1. `pr_description` Artifact Template

**template.yaml:**
```yaml
name: pr_description
description: Pull request description generated by the process orchestrator
format: markdown
```

**content.md:**
```markdown
## Summary

{summary}

## Changes

{changes}

## Test Plan

{test_plan}
```

This template guides the orchestrator's output format. The orchestrator writes the actual content via `write_artifact` with `template_name="pr_description"`.

### 2. PR Body Retrieval

After the finalization orchestrator phase completes in `run_process()`:

1. Query artifacts for the process: filter by `template_name="pr_description"`.
2. If found, extract the artifact content.
3. Store it on `ProcessRun` (add a field: `pr_body: str | None = None`).

### 3. Wiring into `create_pull_request()`

In `src/wiggy/git/operations.py`, modify the PR creation:

1. Accept an optional `body: str | None` parameter.
2. If `body` is provided, use it as the `--body` argument to `gh pr create`.
3. If `body` is `None`, fall back to the current hardcoded string: `"Automated PR from wiggy session {hash_id}"`.

In the caller (CLI or process runner), pass `process_run.pr_body` to `create_pull_request()`.

### 4. `ProcessRun` Change

Add field:

```python
pr_body: str | None = None
```

### 5. Fallback Behavior

- Orchestrator disabled → no finalization → `pr_body` is `None` → hardcoded string used.
- Orchestrator enabled but fails to write artifact → `pr_body` is `None` → hardcoded string used.
- Orchestrator writes artifact → `pr_body` is set → used as PR body.

## Boundary Constraints

- Do NOT modify MCP tools or scoping.
- Do NOT modify config schema.
- Do NOT modify prompt templates (the finalize prompt from chunk 05 already instructs artifact writing).
- Keep the `create_pull_request()` change minimal — just add the optional parameter.

## Verification

- All existing tests pass.
- `mypy src/` and `ruff check src/` pass.
- New tests:
  - `pr_description` template is discoverable via `list_artifact_templates`.
  - `create_pull_request()` uses provided body.
  - `create_pull_request()` falls back to hardcoded string when body is `None`.
  - End-to-end: finalization writes artifact → runner reads it → PR created with generated body.
